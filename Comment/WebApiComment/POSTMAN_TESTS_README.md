# WebApiComment Postman Tests

This directory contains Postman collections and environments for testing the WebApiComment microservice.

## Files

- **WebApiComment.postman_collection.json** - Complete test collection with automated test scripts
- **WebApiComment.postman_environment.json** - Environment configuration for local development

## Features

The Postman collection includes comprehensive tests for:

### Template Endpoints
- ✅ GET all templates
- ✅ GET template by ID
- ✅ POST create template
- ✅ PUT update template
- ✅ DELETE template
- ✅ Error handling (404 for non-existent templates)

### Comment Endpoints
- ✅ GET all comments
- ✅ GET comment by ID
- ✅ GET comments by template ID
- ✅ POST create comment
- ✅ PUT update comment
- ✅ DELETE comment
- ✅ Error handling (404 for non-existent comments, 400 for invalid data)

## Test Features

Each request includes automated test scripts that verify:
- ✅ HTTP status codes
- ✅ Response structure and data types
- ✅ Required properties in responses
- ✅ Data integrity (IDs match, relationships are correct)
- ✅ Response times
- ✅ Error handling

## How to Use

### 1. Import the Collection

1. Open Postman
2. Click **Import** button
3. Select `WebApiComment.postman_collection.json`
4. The collection will appear in your Collections sidebar

### 2. Import the Environment

1. Click **Import** button
2. Select `WebApiComment.postman_environment.json`
3. Select the environment from the dropdown in the top-right corner

### 3. Configure the Environment

The default environment is configured for local development:
- **baseUrl**: `http://localhost:5234`
- **templateId**: Pre-seeded template ID from development database
- **commentId**: Pre-seeded comment ID from development database

You can modify these values in Postman's Environment tab.

### 4. Run the Tests

#### Option A: Run Individual Requests
1. Expand the collection folders
2. Click on any request
3. Click **Send**
4. View the test results in the **Test Results** tab

#### Option B: Run All Tests with Collection Runner
1. Right-click on the collection name
2. Select **Run collection**
3. Click **Run WebApiComment Tests**
4. View the test results summary

#### Option C: Run via Newman (CLI)
```bash
# Install Newman (if not already installed)
npm install -g newman

# Run the collection
newman run WebApiComment.postman_collection.json -e WebApiComment.postman_environment.json

# Run with detailed output
newman run WebApiComment.postman_collection.json -e WebApiComment.postman_environment.json --reporters cli,json

# Run with HTML report
npm install -g newman-reporter-html
newman run WebApiComment.postman_collection.json -e WebApiComment.postman_environment.json --reporters cli,html
```

## Test Execution Order

For best results, run tests in this order:

1. **Template Endpoints** → **Get All Templates** (populates templateId)
2. **Template Endpoints** → **Create Template** (populates createdTemplateId)
3. **Template Endpoints** → **Update Template**
4. **Comment Endpoints** → **Get All Comments** (populates commentId)
5. **Comment Endpoints** → **Create Comment** (populates createdCommentId)
6. **Comment Endpoints** → **Update Comment**
7. **Comment Endpoints** → **Delete Comment**
8. **Template Endpoints** → **Delete Template**

The Collection Runner will execute them in the correct order automatically.

## Environment Variables

The collection uses the following environment variables:

| Variable | Description | Example |
|----------|-------------|---------|
| `baseUrl` | Base URL of the API | `http://localhost:5234` |
| `templateId` | ID of an existing template | `10000000-0000-0000-0000-000000000001` |
| `commentId` | ID of an existing comment | `20000000-0000-0000-0000-000000000001` |
| `createdTemplateId` | ID of newly created template (auto-populated) | Generated by tests |
| `createdCommentId` | ID of newly created comment (auto-populated) | Generated by tests |

## Prerequisites

Before running the tests, ensure:

1. ✅ WebApiComment service is running on the configured port (default: 5234)
2. ✅ Database is properly configured and seeded with initial data
3. ✅ SQL Server is running and accessible

### Starting the Service

```bash
cd /path/to/Comment/WebApiComment
dotnet run
```

The service should be accessible at `http://localhost:5234` (or `https://localhost:7234` for HTTPS).

## Troubleshooting

### Tests Fail with Connection Errors
- Verify the service is running: `curl http://localhost:5234/api/template`
- Check the `baseUrl` in the environment matches your service URL

### 404 Errors on GET by ID Tests
- Run "Get All Templates" or "Get All Comments" first to populate IDs
- Verify the database has been seeded with initial data

### 400 Errors on POST/PUT Requests
- Check the request body format matches the DTO structure
- Verify required fields are included
- Ensure GUID format is valid

### Database Not Seeded
The service automatically seeds data in Development mode. If needed, you can:
1. Delete the database
2. Restart the service
3. Migrations and seeding will run automatically

## CI/CD Integration

You can integrate these tests into your CI/CD pipeline:

```yaml
# Example GitHub Actions workflow
- name: Run Postman Tests
  run: |
    npm install -g newman
    newman run Comment/WebApiComment/WebApiComment.postman_collection.json \
      -e Comment/WebApiComment/WebApiComment.postman_environment.json \
      --bail
```

## Additional Resources

- [Postman Documentation](https://learning.postman.com/)
- [Newman CLI Documentation](https://learning.postman.com/docs/running-collections/using-newman-cli/command-line-integration-with-newman/)
- [Writing Postman Tests](https://learning.postman.com/docs/writing-scripts/test-scripts/)

## Support

For issues or questions, please refer to the main repository documentation or create an issue in the project repository.
